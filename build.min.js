angular.module("App",["ui.router"]).config(function(e,t){t.when("/note","/note/:id"),e.state("login",{url:"",templateUrl:"templates/login.html",controller:"LoginCtrl"}).state("editor",{url:"/note/:id",templateUrl:"templates/editor.html",controller:"EditorCtrl"}).state("index",{url:"/",templateUrl:"templates/main.html"}),t.otherwise("/")}).run(["$rootScope","$state","$location",function(e,t){e.$on("$locationChangeStart",function(e){Parse.User.current()||(e.preventDefault(),t.go("login"))})}]),angular.module("App").controller("EditorCtrl",function(e,t,n){n.buildModel(t.params.id,function(t){e.note=t,e.$apply()}),e.back=function(){clearInterval(o),n.save(e.note,function(){console.log("saved"),e.note=null}),t.go("index")};var o;(function(){var t=angular.copy(e.note);o=setInterval(function(){JSON.stringify(t)!==JSON.stringify(e.note)&&n.save(e.note,function(){console.log("saved")}),t=angular.copy(e.note)},2e3)})()}),angular.module("App").controller("ViewNotebookCtrl",function(e){e.params=$stateParams}),angular.module("App").controller("LoginCtrl",function(e,t,n){e.login=function(){Parse.FacebookUtils.logIn(null,"pass").then(function(e){e.existed()?n.buildModel(e,function(){t.go("index")}):n.newUser(e,function(e){n.buildModel(e,function(){t.go("index")})})})}}),angular.module("App").controller("MainCtrl",function(e,t,n,o,r,l){e.searchString="",e.newNote=function(){l.newNote(function(e){t.go("editor",{id:e})})},e.logout=function(){t.go("login"),e.user=null,r.logout(function(){})},e.$watch(function(){return r.model},function(){Parse.User.current()&&!e.user&&r.buildModel(Parse.User.current(),function(){e.user=r.model,e.$apply()})},!0)}),angular.module("App").factory("NoteService",function(){var e={};return e.model=null,e.newNote=function(t){var n=Parse.Object.extend("Note"),o=new n;o.set("parent",Parse.User.current()),o.set("title",""),o.set("body",""),o.save().then(function(n){e.model={},e.model.title="",e.model.body="",t(n.id)})},e.buildModel=function(t,n){var o=new Parse.Query("Note");o.get(t).then(function(t){t.get("parent").id!==Parse.User.current().id&&console.error("Note does not belong to current user"),e.model={title:t.get("title"),body:t.get("body"),id:t.id},n(e.model)})},e.save=function(e,t){var n=e.title,o=e.body,r=new Parse.Query("Note");r.get(e.id).then(function(e){e.set("title",n),e.set("body",o),e.save().then(function(e){t(e)})})},e}),angular.module("App").factory("NotebookService",function(){var e={};return e}),angular.module("App").factory("UserService",function(){var e={};return e.newUser=function(e,t){FB.api("/me",function(n){n&&!n.error&&(e.set("name",n.first_name),e.save().then(function(){t(e)}))})},e.model=null,e.buildModel=function(t,n){var o=new Parse.Query("Note");o.equalTo("parent",t),o.find().then(function(o){console.log(o),e.model={},e.model.name=t.get("name"),e.model.id=t.id,e.model.notes=[],angular.forEach(o,function(t){e.model.notes.push({title:t.get("title"),body:t.get("body"),id:t.id})}),n(e.model)})},e.logout=function(t){FB.getLoginStatus(function(n){n&&"connected"===n.status&&FB.logout(function(){Parse.User.logOut(),e.model=null,t()})})},e});